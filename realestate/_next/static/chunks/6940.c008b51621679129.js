"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6940],{86940:function(e,t,s){s.r(t),s.d(t,{default:function(){return M}});var i=s(85893),r=s(67294),a=s(9473),n=s(25675),l=s.n(n),o=s(27435),d=s(94050),c=s(2914),u=s(62204),p=s(1927),m=s(9559),h={src:"/_next/static/media/no_chat_found.3fe6dd7c.svg"},_=s(61026),g=s(86455),v=s.n(g),f=s(11163),x=s(2149),j=s(27680),y=s(86501),N=s(30381),w=s.n(N),b=s(62760),C=e=>{let{lightboxOpen:t,handleCloseLightbox:s,currentImage:r}=e;return t&&(0,i.jsx)("div",{className:"lightbox-overlay",children:(0,i.jsxs)("div",{className:"lightbox-modal",children:[(0,i.jsx)("div",{className:"lightbox-header",children:(0,i.jsx)("button",{onClick:s,className:"lightbox-close-button",children:(0,i.jsx)(j.QAE,{size:24})})}),(0,i.jsx)("div",{className:"lightbox-content",children:(0,i.jsx)("img",{src:r,alt:"Image",className:"lightbox-image",onError:_.jM})})]})})};let{TabPane:I}=o.default;var k=e=>{var t;let{notificationData:s}=e,n=(0,r.useRef)(null),g=(0,f.useRouter)(),N=(0,a.v9)(p.vV),k=(0,a.v9)(e=>e.User_signup),S=(0,a.v9)(x.c6),E=null==N?void 0:N.web_placeholder_logo,D=k&&k.data?k.data.data.id:null,F=null==k?void 0:null===(t=k.data)||void 0===t?void 0:t.data,[M,R]=(0,r.useState)([]),L=M.reduce((e,t)=>(e[t.property_id]={messageInput:"",showVoiceButton:!0,selectedFile:null,recording:!1,mediaRecorder:null,audioChunks:[],messages:[],...S&&S[t.property_id]?S[t.property_id]:{}},e),{}),[P,z]=(0,r.useState)(e=>0===Object.keys(null!=e?e:{}).length?L:e),[B,U]=(0,r.useState)(!1),[T,O]=(0,r.useState)(null),[Z,A]=(0,r.useState)([]),[W,Y]=(0,r.useState)(S?null==S?void 0:S.property_id:""),[H,V]=(0,r.useState)(null),[K,X]=(0,r.useState)(""),[q,Q]=(0,r.useState)(0),[G,J]=(0,r.useState)(10),[$,ee]=(0,r.useState)({}),[et,es]=(0,r.useState)(!1),[ei,er]=(0,r.useState)(!1),[ea,en]=(0,r.useState)([]),[el,eo]=(0,r.useState)(!1),ed=(0,r.useCallback)(()=>{if(n.current){let e=n.current;e.scrollHeight,e.clientHeight,e.scrollTop,e.classList.add("smooth-scroll"),e.scrollTop=e.scrollHeight,setTimeout(()=>{e.classList.remove("smooth-scroll")},1e3)}},[]),ec=(e,t)=>{z(s=>({...s,[e]:{...s[e],messageInput:t}}))},eu=(e,t)=>{let s=e.target.files[0];z(e=>({...e,[t]:{...e[t],selectedFile:s}})),X(s.name),V(s)},ep=e=>{let t=document.getElementById("fileInput-".concat(e));t&&(t.value=""),z(t=>({...t,[e]:{...t[e],selectedFile:null}})),V(null),X("")},em=e=>{document.getElementById("fileInput-".concat(e)).click()},eh=async e=>{try{if(!(await navigator.mediaDevices.enumerateDevices()).some(e=>"audioinput"===e.kind)){v().fire({title:(0,_.Iu)("noMicroPhoneFound"),text:(0,_.Iu)("pleaseConnectAMircoPhone"),icon:"warning",confirmButtonText:(0,_.Iu)("ok")});return}let t=await navigator.mediaDevices.getUserMedia({audio:!0}),s=new MediaRecorder(t),i=[];s.ondataavailable=e=>{e.data.size>0&&i.push(e.data)},s.onstop=()=>{z(t=>{var s;return{...t,[e]:{...t[e]||{},audioChunks:[...(null===(s=t[e])||void 0===s?void 0:s.audioChunks)||[],...i]}}})},s.start(),z(t=>({...t,[e]:{...t[e]||{},recording:!0,mediaRecorder:s}})),U(!0)}catch(e){console.log("error",e),"NotAllowedError"===e.name||"PermissionDeniedError"===e.name?v().fire({title:(0,_.Iu)("permissionDenied"),text:(0,_.Iu)("pleaseConnectAMircoPhone"),icon:"warning",confirmButtonText:(0,_.Iu)("ok")}):"NotFoundError"===e.name||"DevicesNotFoundError"===e.name?v().fire({title:(0,_.Iu)("noMicroPhoneFound"),text:(0,_.Iu)("pleaseConnectAMircoPhone"),icon:"warning",confirmButtonText:(0,_.Iu)("ok")}):y.ZP.error((0,_.Iu)("permissionDenyForMic"))}},e_=e=>{var t,s;(null===(t=P[e])||void 0===t?void 0:t.mediaRecorder)&&(null===(s=P[e])||void 0===s||s.mediaRecorder.stop(),z(t=>({...t,[e]:{...t[e],recording:!1}})),U(!1))},eg=e=>{},ev=e=>{var t,s;let i;let r=P[e]||{},a=null===(t=r.messageInput)||void 0===t?void 0:t.trim(),n=r.selectedFile||r.audioChunks&&r.audioChunks.length>0;if(a&&n)i="file_and_text";else if(a)i="text";else if(n)i=r.selectedFile?"file":"audio";else{y.ZP.error((0,_.Iu)("enterChatMessage"));return}if("text"===i&&!(null===(s=r.messageInput)||void 0===s?void 0:s.trim())){y.ZP.error((0,_.Iu)("enterChatMessage"));return}eo(!0);let l={sender_id:D,receiver_id:T.user_id,property_id:T.property_id,chat_message_type:i,message:r.messageInput,file:r.selectedFile,audio:r.audioChunks,created_at:new Date().toISOString()};(0,m.zK)(l.sender_id,l.receiver_id,l.message?l.message:(l.file||l.audio,""),l.property_id,l.file?l.file:"",l.audio?l.audio:"",t=>{if("audio"===i&&r.audioChunks.length>0){let e=new File([new Blob(r.audioChunks,{type:"audio/webm;codecs=opus"})],"audio_message.webm",{type:"audio/webm;codecs=opus"});l={...l,audio:e}}z(t=>{var s;return{...t,[e]:{...t[e],messages:[...(null===(s=t[e])||void 0===s?void 0:s.messages)||[],l],messageInput:"",selectedFile:null,audioChunks:[]}}}),A(e=>[...e,l]),eo(!1),V(null),ed()},e=>{console.log(e),y.ZP.error(e),eo(!1)})},ef=()=>{et||(es(!0),(0,m.p4)({property_id:null==T?void 0:T.property_id,page:q+1,per_page:G,onSuccess:e=>{var t;let s=[...e.data.data||[],...(null===(t=P[T.property_id])||void 0===t?void 0:t.messages)||[]].sort((e,t)=>new Date(e.created_at)-new Date(t.created_at));A(e=>[...s,...e]),Q(q+1),es(!1)},onError:e=>{y.ZP.error(null==e?void 0:e.message),es(!1)}}))},ex=e=>{let t=w()(),s=w()(e),i=t.diff(s,"seconds");return i<1?"1s ago":i<60?"".concat(i,"s ago"):i<3600?"".concat(Math.floor(i/60),"m ago"):i<86400?"".concat(Math.floor(i/3600),"h ago"):s.format("h:mm A")},ej=(0,r.useCallback)(e=>{en(e),er(!0)},[]),ey=(0,r.useCallback)(()=>{er(!1)},[]),eN=()=>{if(!T){console.error("No chat selected for deletion");return}let e={...T};v().fire({title:(0,_.Iu)("areYouSure"),text:(0,_.Iu)("areYouSureDeleteChat"),icon:"warning",showCancelButton:!0,confirmButtonText:(0,_.Iu)("yesDelete"),cancelButtonText:(0,_.Iu)("noDelete"),reverseButtons:!0,customClass:{confirmButton:"Swal-confirm-buttons",cancelButton:"Swal-cancel-buttons"}}).then(t=>{t.isConfirmed&&(0,m.CV)(D,e.user_id,e.property_id,t=>{v().fire({title:(0,_.Iu)("deleted"),text:t.message,icon:"success",customClass:{confirmButton:"Swal-confirm-buttons",cancelButton:"Swal-cancel-buttons"}}),R(t=>{let s=t.filter(t=>t.property_id!==e.property_id);if(s.length>0){let e=s[0];O(e),Y(e.property_id.toString()),eC(e)}else O(null),Y(""),A([]);return s}),z(t=>{let s={...t};return delete s[e.property_id],s}),e.property_id===(null==S?void 0:S.property_id)&&(0,x.O6)(),1===M.length&&g.push("/")},e=>{console.error("Error deleting chat:",e),y.ZP.error((0,_.Iu)("errorDeletingChat"))})})},ew=()=>{T&&eC(T)},eb=(e,t)=>{let s=["png","jpg","jpeg"],r=["pdf","doc","docx"],a="file"===e.chat_message_type,n="audio"===e.chat_message_type,l="text"===e.chat_message_type,o="file_and_text"===e.chat_message_type,d=e.file&&"string"==typeof e.file&&s.some(t=>e.file.endsWith(".".concat(t)))||e.file instanceof File&&s.some(t=>e.file.name.endsWith(".".concat(t))),c=e.file&&"string"==typeof e.file&&r.some(t=>e.file.endsWith(".".concat(t)))||e.file instanceof File&&r.some(t=>e.file.name.endsWith(".".concat(t))),u=t=>{if(d)return(0,i.jsxs)("div",{className:"file-preview",children:[(0,i.jsx)("img",{src:e.file instanceof File?URL.createObjectURL(t):t,alt:"File Preview",onClick:()=>ej(e.file instanceof File?URL.createObjectURL(t):t)}),e.message&&(0,i.jsx)("span",{children:e.message})]});if(c){let s=e.file instanceof File?e.file.name:t.split("/").pop();return(0,i.jsxs)("div",{className:"file-preview",children:[(0,i.jsx)("span",{onClick:()=>window.open(t instanceof File?URL.createObjectURL(t):t,"_blank"),className:"file-name",children:s}),e.message&&(0,i.jsx)("span",{children:e.message})]})}return null};return(0,i.jsxs)("div",{className:e.sender_id===D?"user-message":"other-message",children:[n&&(0,i.jsx)("div",{className:e.sender_id===D?"user-audio":"other-audio",children:"string"==typeof e.audio?(0,i.jsxs)("audio",{controls:!0,children:[(0,i.jsx)("source",{src:e.audio,type:"audio/webm;codecs=opus"}),"Your browser does not support the audio element."]}):e.audio&&e.audio instanceof File&&e.audio.type.startsWith("audio/")?(0,i.jsxs)("audio",{controls:!0,children:[(0,i.jsx)("source",{src:URL.createObjectURL(e.audio),type:"audio/webm;codecs=opus"}),"Your browser does not support the audio element."]}):null}),a&&e.file?u(e.file):null,l&&(0,i.jsx)("span",{className:"text-message",children:e.message}),o&&e.file&&(0,i.jsx)("div",{children:u(e.file)})]},t)};(0,r.useEffect)(()=>{(null==F?void 0:F.data)===null&&g.push("/")},[F]),(0,r.useEffect)(()=>{if(s){let e={sender_id:s.sender_id,receiver_id:s.receiver_id,property_id:s.property_id,chat_message_type:s.chat_message_type,user_profile:null==s?void 0:s.user_profile,message:s.message,file:s.file,audio:s.audio,created_at:s.created_at};z(t=>{var i;return{...t,[s.property_id]:{...t[s.property_id],messages:[...(null===(i=t[s.property_id])||void 0===i?void 0:i.messages)||[],e]}}}),A(t=>{let s=[...t,e];return setTimeout(ed,0),s})}},[s]),(0,r.useEffect)(()=>{(0,m.lb)({onSuccess:e=>{R(e.data),S?(e.data.some(e=>e.property_id===S.property_id)||R(e=>[S,...e]),O(S),Y(S.property_id)):(O(e.data[0]),Y(e.data[0].property_id))},onError:e=>{console.log(e)}})},[S]);let eC=e=>{let t=$[e.property_id]||0;(0,m.p4)({property_id:null==e?void 0:e.property_id,page:0,per_page:10,onSuccess:s=>{let i=(s.data.data||[]).filter(e=>new Date(e.created_at).getTime()>t);A(e=>{let t=[...e,...i];return Array.from(new Set(t.map(e=>e.created_at))).map(e=>t.find(t=>t.created_at===e)).sort((e,t)=>new Date(e.created_at)-new Date(t.created_at))}),Q(1),es(!1),ed(),i.length>0&&ee(t=>({...t,[e.property_id]:new Date(i[i.length-1].created_at).getTime()}))},onError:e=>{y.ZP.error(e),es(!1)}})};return(0,r.useEffect)(()=>{T&&(0,m.p4)({property_id:null==T?void 0:T.property_id,page:q,per_page:G,onSuccess:e=>{var t;A([...e.data.data||[],...(null===(t=P[T.property_id])||void 0===t?void 0:t.messages)||[]].sort((e,t)=>new Date(e.created_at)-new Date(t.created_at))),Q(q+1),es(!1)},onError:e=>{y.ZP.error(e),es(!1)}})},[T]),(0,r.useEffect)(()=>{let e=null==n?void 0:n.current,t=()=>{0===e.scrollTop&&ef()};return n.current&&n.current.addEventListener("scroll",t),()=>{n.current&&n.current.removeEventListener("scroll",t)}},[T,q,et]),(0,r.useEffect)(()=>{},[T,W,H,Z]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"messages",children:(0,i.jsxs)("div",{className:"container",children:[(0,i.jsx)("div",{className:"dashboard_titles",children:(0,i.jsx)("h3",{children:(0,_.Iu)("messages")})}),(0,i.jsx)("div",{className:"card",children:(null==M?void 0:M.length)>0&&""!==M?(0,i.jsx)(o.default,{defaultActiveKey:W,tabPosition:"left",onChange:e=>{let t=M.find(t=>t.property_id===Number(e));O(t),z(t=>({...t,[e]:{...t[e]||{},messageInput:"",showVoiceButton:!0,selectedFile:null,recording:!1,mediaRecorder:null,audioChunks:[],messages:[]}})),Y(s=>(s!==e&&(Q(1),eC(t)),e))},children:M.map(e=>{var t,s;return(0,i.jsx)(I,{tab:(0,i.jsxs)("div",{className:"message_list_details",children:[(0,i.jsx)("div",{className:"profile_img",children:(0,i.jsx)(l(),{loading:"lazy",id:"profile",src:(null==e?void 0:e.profile)?null==e?void 0:e.profile:E,alt:"no_img",width:0,height:0,onError:_.jM})}),(0,i.jsxs)("div",{className:"profile_name",children:[(0,i.jsx)("span",{className:"user_name",children:null==e?void 0:e.name}),(0,i.jsx)("span",{className:"property_title",children:null==e?void 0:e.title})]})]}),children:(0,i.jsxs)("div",{className:"chat_deatils",children:[(0,i.jsxs)("div",{className:"chat_deatils_header",children:[(0,i.jsxs)("div",{className:"profile_img_name_div",children:[(0,i.jsx)("div",{className:"chat_profile_div",children:(0,i.jsx)(l(),{loading:"lazy",id:"chat_profile",src:(null==e?void 0:e.title_image)?null==e?void 0:e.title_image:E,alt:"no_img",width:0,height:0,onError:_.jM})}),(0,i.jsxs)("div",{className:"profile_name",children:[(0,i.jsx)("span",{className:"user_name",children:null==e?void 0:e.name}),(0,i.jsx)("span",{className:"property_title",children:null==e?void 0:e.title})]})]}),Z.length>0&&(0,i.jsxs)("div",{className:"right_icons",children:[(0,i.jsx)("div",{className:"delete_messages",onClick:eN,children:(0,i.jsx)("span",{children:(0,i.jsx)(u.F1H,{size:22})})}),(0,i.jsx)("div",{className:"reload_messages",onClick:()=>ew(),children:(0,i.jsx)("span",{children:(0,i.jsx)(b.jq8,{size:18})})})]})]}),(0,i.jsxs)("div",{className:"chat_display",ref:n,children:[(0,i.jsx)("div",{className:"sender_masg",children:Z.length>0?Z.map((e,t)=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:e.sender_id===D?"user-message":"other-message",children:eb(e,t)},t),(0,i.jsx)("div",{className:e.sender_id===D?"user-message-time":"other-message-time",children:(0,i.jsx)("span",{className:"chat_time",children:ex(e.created_at)})})]})):(0,i.jsxs)("div",{className:"col-12 text-center",id:"noChats",children:[(0,i.jsx)("div",{children:(0,i.jsx)(l(),{loading:"lazy",src:h.src,alt:"start_chat",width:250,height:250,onError:_.jM})}),(0,i.jsx)("div",{className:"no_page_found_text",children:(0,i.jsx)("h3",{children:(0,_.Iu)("startConversation")})})]})}),(0,i.jsx)("div",{})]}),H&&(0,i.jsx)("div",{className:"file-preview-section",children:(0,i.jsxs)(i.Fragment,{children:[H.type.startsWith("image/")?(0,i.jsx)("img",{src:URL.createObjectURL(H),alt:H.name}):(0,i.jsx)("span",{children:H.name}),(0,i.jsx)("button",{className:"change-button",onClick:()=>ep(e.property_id),children:(0,i.jsx)(j.mzH,{size:35})})]})}),(0,i.jsxs)("div",{className:"chat_inputs",children:[(0,i.jsxs)("div",{className:"attechment",onClick:()=>em(e.property_id),children:[(0,i.jsx)(u.WX2,{size:20}),(0,i.jsx)("input",{type:"file",id:"fileInput-".concat(e.property_id),onChange:t=>eu(t,e.property_id)})]}),(0,i.jsx)("div",{className:"type_input",children:(0,i.jsx)("input",{type:"text",placeholder:(0,_.Iu)("typeYourMessage"),value:null===(t=P[e.property_id])||void 0===t?void 0:t.messageInput,onChange:t=>ec(e.property_id,t.target.value),onKeyDown:t=>{"Enter"===t.key&&(t.preventDefault(),ev(e.property_id))}})}),(0,i.jsxs)("div",{className:"hide-attechment",onClick:()=>em(e.property_id),children:[(0,i.jsx)(u.WX2,{size:20}),(0,i.jsx)("input",{type:"file",id:"fileInput-".concat(e.property_id),onChange:t=>eu(t,e.property_id)})]}),(null===(s=P[e.property_id])||void 0===s?void 0:s.recording)?(0,i.jsx)("button",{className:"voice_message recording",onMouseDown:()=>eh(e.property_id),onMouseUp:()=>e_(e.property_id),onMouseMove:()=>eg(e.property_id),children:(0,i.jsx)(c.uYL,{size:30})}):(0,i.jsx)("button",{className:"voice_message",onMouseDown:()=>eh(e.property_id),onMouseUp:()=>e_(e.property_id),onMouseMove:()=>eg(e.property_id),children:(0,i.jsx)(c.uYL,{size:20})}),(0,i.jsx)("button",{type:"submit",className:"send_message",disabled:el,style:{cursor:el?"not-allowed":"pointer"},onClick:()=>ev(e.property_id),children:el?(0,i.jsx)("div",{className:"loader-container-otp",children:(0,i.jsx)("div",{className:"loader-otp"})}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("span",{children:[" ",(0,_.Iu)("send")," "]}),(0,i.jsx)(d.n3D,{size:20})]})})]})]})},e.property_id)})}):(0,i.jsxs)("div",{className:"col-12 text-center",id:"noChats",children:[(0,i.jsx)("div",{children:(0,i.jsx)(l(),{loading:"lazy",src:h.src,alt:"no_chats",width:450,height:450,onError:_.jM})}),(0,i.jsx)("div",{className:"no_page_found_text",children:(0,i.jsx)("h3",{children:(0,_.Iu)("noChat")})})]})})]})}),(0,i.jsx)(C,{lightboxOpen:ei,handleCloseLightbox:ey,currentImage:ea})]})},S=s(5152),E=s.n(S),D=s(44121);let F=E()(()=>Promise.all([s.e(6152),s.e(7653),s.e(383),s.e(4881),s.e(8154),s.e(2764),s.e(6327),s.e(6288),s.e(3141),s.e(226)]).then(s.bind(s,33141)),{ssr:!1});var M=()=>{let[e,t]=(0,r.useState)(null);return(0,r.useEffect)(()=>{},[e]),(0,i.jsx)(D.Z,{onNotificationReceived:e=>{t(e)},children:(0,i.jsx)(F,{children:(0,i.jsx)(k,{notificationData:e,setNotificationData:t})})})}}}]);